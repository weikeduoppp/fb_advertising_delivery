(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{FzQT:function(e,a,t){"use strict";t.r(a);var n=t("q1tI"),r=t.n(n),i=t("hWJ+"),c=t("/MKj"),s=t("qIgq"),l=t.n(s),u=(t("/xke"),t("TeRw")),o=t("p0pE"),d=t.n(o),p=t("d6i3"),_=t.n(p),m=(t("miYZ"),t("tsqr")),b=t("Y/ft"),h=t.n(b),g=t("1l/V"),f=t.n(g),v=(t("/zsF"),t("PArb")),y=t("CrlF"),k=t.n(y),x=t("JwKJ"),w=t("T99t"),j=t("pGep"),S=t("hQyA"),E=t("9Knd"),C=t("RRGs"),O=e=>{e.adaccount_id;var a=e.title,t=void 0===a?"\u521b\u5efa\u5e7f\u544a\u7cfb\u5217":a,i=e.visible,c=e.setVisible,s=e.initailState,u=void 0===s?S["b"]:s,o=e.updateTable,p=e.campaign_id,b=Object(n["useReducer"])(S["d"],u),h=l()(b,2),g=h[0],v=h[1],y=Object(E["a"])(p);function k(e){return x.apply(this,arguments)}function x(){return x=f()(_.a.mark(function e(a){var t;return _.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,j["updateCampaign"](p,d()({},g));case 2:t=e.sent,t.success&&O("\u66f4\u65b0\u6210\u529f !",a);case 4:case"end":return e.stop()}},e)})),x.apply(this,arguments)}function O(e,a){a(!1),c(!1),o(),m["a"].success(e)}return g.name!==u.name&&p!==y&&v({type:"reset",payload:u}),r.a.createElement(w["a"],{title:t,visible:i,handle:e=>{k(e)},handleCancel:()=>{c(!1),v({type:"reset",payload:u})}},r.a.createElement(C["a"],{state:g,dispatch:v}))},I=t("3a4m"),P=t.n(I),N=t("7Qib"),T=t("flnC"),A=t("0ECY"),J=e=>{var a=e.adaccount_id,t=e.title,n=e.visible,i=e.setVisible,c=(e.children,e.toCreate),s=e.handleSubmit,l=e.handlePages;return r.a.createElement(w["a"],{title:t,visible:n,handle:e=>{c(e)},handleCancel:()=>{i(!1)}},r.a.createElement(r.a.Fragment,null,r.a.createElement(A["a"],{handleSubmit:l}),r.a.createElement(T["a"],{adaccount_id:a,handleSubmit:s})))},K=J,L=Object(n["memo"])(e=>{var a=e.selectKeys,t=e.data,i=e.search,c=e.loading,s=e.updateTable,o=e.dispatch,p=e.adset_select,b=e.setCopyModel,g=e.adaccount_id,y=e.copied_id,w=Object(n["useState"])(null),E=l()(w,2),C=E[0],I=E[1],T=Object(n["useState"])(!1),A=l()(T,2),J=A[0],L=A[1],V=Object(n["useState"])(null),D=l()(V,2),F=D[0],G=D[1],M=Object(n["useState"])(null),R=l()(M,2),Y=R[0],q=R[1],z=Object(n["useState"])(!1),Q=l()(z,2),W=Q[0],U=Q[1],Z=Object(n["useState"])(),B=l()(Z,2),H=B[0],X=B[1],$=Object(n["useState"])(),ee=l()($,2),ae=ee[0],te=ee[1],ne=Object(n["useState"])(!1),re=l()(ne,2),ie=re[0],ce=re[1],se=Object(n["useState"])(null),le=l()(se,2),ue=le[0],oe=le[1],de=Object(n["useState"])(null),pe=l()(de,2),_e=pe[0],me=pe[1];function be(e){oe(e.id),me({objective:e.objective,status:e.status,name:e.name,daily_budget:e.daily_budget&&e.daily_budget/100,bid_strategy:e.bid_strategy,special_ad_category:e.special_ad_category}),ce(!0)}Object(n["useEffect"])(()=>{if(y){var e=t.find(e=>e.id===y);be(e),o({type:"global/set_copied_id",payload:""})}return()=>{}},[y,t,o]);var he=[{title:"\u5e7f\u544a\u7cfb\u5217\u540d\u79f0",dataIndex:"name",render:(e,a)=>r.a.createElement("span",{className:k.a._a,onClick:e=>{o({type:"global/set_campaigns",payload:[a]}),P.a.push("/adset")}},e)},{title:"\u8425\u9500\u76ee\u6807",dataIndex:"objective",render:(e,a)=>r.a.createElement("span",null,e)},{title:"\u6295\u653e\u72b6\u6001",dataIndex:"status",sorter:(e,a)=>e.status.toString().localeCompare(a.status),render:e=>e},{title:"\u64cd\u4f5c",key:"action",width:"15%",render:(e,a)=>r.a.createElement("span",null,r.a.createElement("span",{className:k.a._a,onClick:e=>{be(a)}},"\u7f16\u8f91"),r.a.createElement(v["a"],{type:"vertical"}),r.a.createElement("span",{className:k.a._a,onClick:e=>{o({type:"global/set_campaigns",payload:[a]}),b(!0)}},"\u590d\u5236"))}],ge={bordered:!0,rowSelection:{onChange(e,a){console.log(e,a),o({type:"global/set_campaigns",payload:a});var t=p.slice();t.filter(e=>-1!==a.findIndex(a=>a.id===e.campaign_id)),o({type:"global/set_adsets",payload:t})},selectedRowKeys:a},pagination:{defaultPageSize:200,showQuickJumper:!0},scroll:t.length>20?{y:"calc(100vh - 343px)"}:void 0};function fe(){return ve.apply(this,arguments)}function ve(){return ve=f()(_.a.mark(function e(){var t;return _.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,j["getCopyInfo"](a);case 2:t=e.sent,I(t.map(e=>JSON.parse(e.body))),m["a"].success("\u5df2\u590d\u5236\u5b8c, \u53ef\u4ee5\u66f4\u6362\u8d26\u53f7\u540e\u7c98\u8d34");case 5:case"end":return e.stop()}},e)})),ve.apply(this,arguments)}function ye(e){return ke.apply(this,arguments)}function ke(){return ke=f()(_.a.mark(function e(a){var t;return _.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,j["createCampaign"](g,a,"COPY");case 2:if(t=e.sent,!t.id){e.next=5;break}return e.abrupt("return",t.id);case 5:case"end":return e.stop()}},e)})),ke.apply(this,arguments)}function xe(e){return we.apply(this,arguments)}function we(){return we=f()(_.a.mark(function e(a){var t,n;return _.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,j["createAds"](g,a);case 2:return t=e.sent,n=t.id,e.abrupt("return",n);case 5:case"end":return e.stop()}},e)})),we.apply(this,arguments)}function je(e,a){return Se.apply(this,arguments)}function Se(){return Se=f()(_.a.mark(function e(a,t){var n,r,i,c,s,l,u,o;return _.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(n=a.link_data,r=a.video_data,a.page_id=H||"",a.instagram_actor_id=ae||"",!n){e.next=19;break}if(!n.child_attachments){e.next=9;break}a.link_data.child_attachments=n.child_attachments.map(function(){var e=f()(_.a.mark(function e(a){var r,i,c;return _.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return r=n.image_hash,e.next=3,j["getImages"](F,[r]);case 3:return i=e.sent,c=i.data,a.picture=c[0].permalink_url,delete a.image_hash,t&&(a.link=Y.object_store_url,a.call_to_action.value.link=Y.object_store_url,a.call_to_action.value.application=Y.application_id),e.abrupt("return",a);case 9:case"end":return e.stop()}},e)}));return function(a){return e.apply(this,arguments)}}()),e.next=17;break;case 9:return i=n.image_hash,e.next=12,j["getImages"](F,[i]);case 12:c=e.sent,s=c.data,a.link_data.picture=s[0].permalink_url,delete a.link_data.image_hash,t&&(a.link_data.link=Y.object_store_url,a.link_data.call_to_action.value.link=Y.object_store_url,a.link_data.call_to_action.value.application=Y.application_id);case 17:e.next=28;break;case 19:if(!r){e.next=28;break}return l=r.image_hash,e.next=23,j["getImages"](F,[l]);case 23:u=e.sent,o=u.data,delete a.video_data.image_hash,a.video_data.image_url=o[0].permalink_url,t&&(a.video_data.call_to_action.value.link=Y.object_store_url,a.video_data.call_to_action.value.application=Y.application_id);case 28:return e.abrupt("return",{object_story_spec:Object(N["c"])(a)});case 29:case"end":return e.stop()}},e)})),Se.apply(this,arguments)}function Ee(e,a,t){return Ce.apply(this,arguments)}function Ce(){return Ce=f()(_.a.mark(function e(a,t,n){var r,i,c,s,u,o,p,m,b;return _.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(a.page_id=H||"",a.instagram_actor_id=ae||"",r=n,i=l()(r.ad_formats,1),c=i[0],s=l()(r.link_urls,1),u=s[0],o=r.images,p=r.videos,t&&(u.website_url=Y.object_store_url,n.link_urls=[u]),"SINGLE_IMAGE"!==c||!o){e.next=12;break}return e.next=7,j["getImages"](F,o.map(e=>e.hash));case 7:m=e.sent,b=m.data,n=d()({},n,{images:b.map(e=>({url:e.permalink_url}))}),e.next=13;break;case 12:"SINGLE_VIDEO"===c&&p&&(n=d()({},n,{videos:p.map(e=>({video_id:e.video_id,thumbnail_url:e.thumbnail_url}))}));case 13:return e.abrupt("return",{object_story_spec:Object(N["c"])(a),asset_feed_spec:n});case 14:case"end":return e.stop()}},e)})),Ce.apply(this,arguments)}function Oe(){return Ie.apply(this,arguments)}function Ie(){return Ie=f()(_.a.mark(function e(){var a,t;return _.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:m["a"].success("\u5f00\u59cb\u590d\u5236!!"),e.prev=1,a=_.a.mark(function e(a){var t,n,r,i,c,s;return _.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=C[a],t.id,n=t.adsets,r=h()(t,["id","adsets"]),e.next=4,ye(d()({},r,{status:"PAUSED"}));case 4:if(i=e.sent,!n){e.next=11;break}return c=n.data,e.next=9,j["batchCreateAdset"](g,i,c,Y);case 9:s=e.sent,s.forEach(function(){var e=f()(_.a.mark(function e(a,t){var n,i,s,l,o;return _.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:n=JSON.parse(a.body),200===a.code?(i=n.id,s=c[t].ads,l=c[t].is_dynamic_creative,s&&(o=s.data,o.forEach(function(){var e=f()(_.a.mark(function e(a){var t,n,c,s;return _.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(a.id,t=a.creative,t.id,n=h()(t,["id"]),c=h()(a,["id","creative"]),!l){e.next=7;break}return e.next=4,Ee(n.object_story_spec,"APP_INSTALLS"===r.objective,n.asset_feed_spec);case 4:e.t0=e.sent,e.next=10;break;case 7:return e.next=9,je(n.object_story_spec,"APP_INSTALLS"===r.objective);case 9:e.t0=e.sent;case 10:return n=e.t0,e.next=13,xe(d()({},c,{creative:n,adset_id:i}));case 13:s=e.sent,console.log(s);case 15:case"end":return e.stop()}},e)}));return function(a){return e.apply(this,arguments)}}()))):u["a"].error({message:"\u590d\u5236\u5931\u8d25",description:"".concat(c[t].name,"\u5e7f\u544a\u7ec4\u590d\u5236\u5931\u8d25 info: ").concat(n.error.message),duration:null});case 2:case"end":return e.stop()}},e)}));return function(a,t){return e.apply(this,arguments)}}());case 11:case"end":return e.stop()}},e)}),t=0;case 4:if(!(t<C.length)){e.next=9;break}return e.delegateYield(a(t),"t0",6);case 6:t++,e.next=4;break;case 9:m["a"].success("\u590d\u5236\u5b8c\u6210"),L(!1),s(),e.next=17;break;case 14:e.prev=14,e.t1=e["catch"](1),L(!1);case 17:case"end":return e.stop()}},e,null,[[1,14]])})),Ie.apply(this,arguments)}function Pe(){return C.filter(e=>{e.id,e.adsets;var a=h()(e,["id","adsets"]);return"APP_INSTALLS"===a.objective}).length}function Ne(e){if(67===e.keyCode&&e.ctrlKey&&a.length&&(m["a"].success("\u51c6\u5907\u590d\u5236\u6e90\u6570\u636e"),G(g),fe()),86===e.keyCode&&e.ctrlKey){if(!C)return!1;if(J||F===g||!F)return m["a"].success("\u4e0d\u80fd\u7c98\u8d34, \u5904\u4e8e\u590d\u5236\u4e2d, \u6ca1\u6709\u590d\u5236\u6e90\u6216\u8005\u540c\u4e00\u8d26\u6237\u4e0b");Pe()?U(!0):(L(!0),Oe())}}return document.onkeydown=ie?null:Ne,r.a.createElement(r.a.Fragment,null,r.a.createElement(x["a"],{params:ge,dataSource:t.filter(e=>-1!==S["c"].indexOf(e.objective)),columns:he,loading:c,search:i}),_e?r.a.createElement(O,{title:"\u7f16\u8f91\u5e7f\u544a\u7cfb\u5217",visible:ie,setVisible:ce,updateTable:s,campaign_id:ue,initailState:_e}):"",W&&r.a.createElement(K,{adaccount_id:g,visible:W,setVisible:U,title:"\u66f4\u6362\u5e94\u7528/\u4e3b\u9875/ins",toCreate:e=>{Y&&(e(!1),U(!1),L(!0),Oe())},handleSubmit:e=>q(e),handlePages:(e,a)=>{"page_id"===a&&X(e),"instagram_actor_id"===a&&te(e)}}))}),V=(e,a)=>{return{selectKeys:e.global.campaigns.map(e=>e.key),adset_select:e.global.adsets,adaccount_id:e.global.adaccount_id,copied_id:e.global.copied_id}},D=Object(c["c"])(V)(L),F=t("m5kd"),G=t("glEz"),M=e=>{var a=e.campaigns,t=e.dispatch,i=e.title,c=e.visible,s=e.setVisible,u=e.updateTable,o=Object(n["useState"])(1),d=l()(o,2),p=d[0],m=d[1];function b(e){return h.apply(this,arguments)}function h(){return h=f()(_.a.mark(function e(n){var r,i,c,l;return _.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(r=[],p>1)for(i=0;i<p;i++)r=[...r,...a.slice()];else r=[...r,...a.slice()];return e.next=4,j["Copy"](r);case 4:if(c=e.sent,!c){e.next=14;break}return console.log(c),n(!1),s(!1),t({type:"global/set_campaigns",payload:[]}),e.next=12,u();case 12:l=JSON.parse(c[0].result).copied_campaign_id,t({type:"global/set_copied_id",payload:l});case 14:case"end":return e.stop()}},e)})),h.apply(this,arguments)}return r.a.createElement(w["a"],{title:i,visible:c,handle:e=>{b(e)},handleCancel:()=>{s(!1)}},r.a.createElement("div",null,r.a.createElement(G["a"],{setNum:m,label:"\u6bcf\u4e2a\u5e7f\u544a\u7cfb\u5217\u7684\u526f\u672c\u6570\u91cf"})))},R=(e,a)=>{return{campaigns:e.global.campaigns}},Y=Object(c["c"])(R)(M),q=r.a.memo(e=>{var a=e.adaccount_id,t=e.data,i=e.setSearch,c=e.defaultCurrent,s=e.total,u=e.paging,o=e.nextOrPrevious,d=e.setDefaultCurrent,p=e.loading,_=e.search,m=e.updateTable,b=e.campaigns,h=Object(n["useState"])(!1),g=l()(h,2),f=g[0],v=g[1];return r.a.createElement("div",{className:k.a.Campaign},r.a.createElement(F["a"],{adaccount_id:a,setSearch:i,defaultCurrent:c,total:s,paging:u,loading:p,num:50,nextOrPrevious:o,setDefaultCurrent:d,setCopyModel:v,copy_bool:b.length>0,createDirection:"campaign"}),r.a.createElement(D,{data:t,loading:p,search:_,setCopyModel:v,updateTable:m}),r.a.createElement(Y,{title:"\u590d\u5236\u5e7f\u544a\u7cfb\u5217",visible:f,setVisible:v,updateTable:m}))}),z=(e,a)=>{return{campaigns:e.global.campaigns}},Q=Object(c["c"])(z)(q),W=e=>{var a=e.adaccount_id;return r.a.createElement(i["a"],{WrappedComponent:Q,method:"getCampaign",adaccount_id:a})},U=(e,a)=>{return{adaccount_id:e.global.adaccount_id}};a["default"]=Object(c["c"])(U)(W)}}]);