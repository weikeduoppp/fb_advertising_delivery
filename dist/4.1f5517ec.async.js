(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"8XgK":function(e,a,t){"use strict";t.r(a);var n=t("q1tI"),c=t.n(n),i=t("hWJ+"),s=t("/MKj"),l=(t("Pwec"),t("CtXQ")),r=t("qIgq"),o=t.n(r),d=t("p0pE"),u=t.n(d),p=(t("T2oS"),t("W9HT")),_=(t("/zsF"),t("PArb")),m=t("d6i3"),h=t.n(m),b=t("Y/ft"),g=t.n(b),v=t("1l/V"),f=t.n(v),y=t("tlA2"),k=t.n(y),x=t("JwKJ"),w=(t("miYZ"),t("tsqr")),E=t("T99t"),O=t("czMb"),j=t("DPwR"),C=t("MrYu"),S=t("pGep"),I=t("9Knd"),N=C["a"],A=e=>{var a=e.adaccount_id,t=e.title,i=void 0===t?"\u521b\u5efa\u5e7f\u544a":t,s=e.visible,l=e.setVisible,r=e.initailState,d=e.updateTable,u=e.ads_id,p=e.objective,_=e.object_store_url,m=e.reset,b=e.is_dynamic_creative,g=e.images,v=Object(n["useReducer"])(b?C["c"]:j["d"],r),y=o()(v,2),k=y[0],x=y[1],A=Object(I["a"])(u);function T(e){return L.apply(this,arguments)}function L(){return L=f()(h.a.mark(function e(t){var n,c,i,s;return h.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(k.link,!k){e.next=11;break}return n=b?N(k.link||_,k,g):Object(j["b"])(k.link||_,k),e.next=4,S["createAdCreative"](a,n);case 4:return c=e.sent,e.next=7,S["updateAds"](u,{name:k.ads_name,status:k.status,creative:{creative_id:c.id}});case 7:i=e.sent,i.success&&M("\u66f4\u65b0\u6210\u529f !",t),e.next=15;break;case 11:return e.next=13,S["updateAds"](u,{name:k.ads_name,status:k.status});case 13:s=e.sent,s.success&&M("\u66f4\u65b0\u6210\u529f !",t);case 15:case"end":return e.stop()}},e)})),L.apply(this,arguments)}function M(e,a){a(!1),d(),w["a"].success(e),l(!1)}return Object(n["useEffect"])(()=>{return u!==A&&m(x),()=>{}},[u,A,x,m]),c.a.createElement(E["a"],{width:750,title:i,visible:s,handle:e=>{T(e)},handleCancel:()=>{x({type:"reset",payload:r}),l(!1)}},c.a.createElement(O["a"],{objective:p,state:k,dispatch:x,is_dynamic_creative:b}))},T=t("7Qib"),L=t("hQyA");function M(e){return e.length-1}function P(e,a,t,n,c){return R.apply(this,arguments)}function R(){return R=f()(h.a.mark(function e(a,t,n,c,i){var s,l,r,o,d,p,_,m,b,g,v,f,y;return h.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!i){e.next=2;break}return e.abrupt("return",J(a,t,n,c));case 2:if(s=a.adcreatives.data[0],l=s.object_story_spec,r=s.asset_feed_spec,-1!==L["c"].indexOf(t)){e.next=5;break}return e.abrupt("return",{ads_name:a.name,status:a.status});case 5:if(o={ads_name:a.name,page_id:l.page_id,instagram_actor_id:l.instagram_actor_id,status:a.status},d=l.link_data,p=l.video_data,!d){e.next=36;break}if(o=u()({},o,d),!d.child_attachments){e.next=24;break}if(o.format="child_attachments",o.call_to_action=d.child_attachments[0].call_to_action.type,_=d.child_attachments.map(e=>e.image_hash),!(_.length>0)){e.next=20;break}return e.next=17,S["getImages"](c,_.filter(e=>null!==e&&void 0!==e));case 17:m=e.sent,b=m.data,n({type:"global/set_images",payload:b});case 20:o.child_attachments=o.child_attachments.map(e=>{return e.app_link=e.call_to_action.value.app_link,Object(T["c"])(e)}),o.link||(o.link=d.child_attachments[0].link||d.child_attachments[0].call_to_action.value.link),e.next=34;break;case 24:if(o.format="photo_data",o.call_to_action=d.call_to_action.type,!d.image_hash){e.next=32;break}return e.next=29,S["getImages"](c,[d.image_hash]);case 29:g=e.sent,v=g.data,n({type:"global/set_images",payload:v});case 32:o.link||(o.link=d.call_to_action.value.link),o.app_link=d.call_to_action.value.app_link;case 34:e.next=54;break;case 36:if(!p){e.next=50;break}if(o.format="video_data",o=u()({},o,p),o.call_to_action=p.call_to_action&&p.call_to_action.type,!p.image_hash){e.next=46;break}return e.next=43,S["getImages"](c,[p.image_hash]);case 43:f=e.sent,y=f.data,n({type:"global/set_videos",payload:[u()({},y[0],{hash:p.video_id})]});case 46:o.link||(o.link=p.call_to_action.value.link),o.app_link=p.call_to_action.value.app_link,e.next=54;break;case 50:if(!r){e.next=54;break}return e.next=53,V(o,r,n,c);case 53:o=e.sent;case 54:return e.abrupt("return",Object(T["c"])(o));case 55:case"end":return e.stop()}},e)})),R.apply(this,arguments)}function J(e,a,t,n){return K.apply(this,arguments)}function K(){return K=f()(h.a.mark(function e(a,t,n,c){var i,s,l,r,o,d,p,_,m,b,g;return h.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(i=a.adcreatives.data[0],s=i.object_story_spec,l=i.asset_feed_spec,r=u()({ads_name:a.name,page_id:s.page_id,instagram_actor_id:s.instagram_actor_id,status:a.status},l),o=l.ad_formats[0],"SINGLE_IMAGE"!==o){e.next=12;break}return d=l.images,e.next=7,S["getImages"](c,d.map(e=>e.hash));case 7:p=e.sent,_=p.data,n({type:"global/set_images",payload:_}),e.next=19;break;case 12:if("SINGLE_VIDEO"!==o){e.next=19;break}return m=l.videos,e.next=16,S["getImages"](c,m.map(e=>e.thumbnail_hash));case 16:b=e.sent,g=b.data,n({type:"global/set_videos",payload:g.map((e,a)=>u()({},e,{hash:m[a].video_id}))});case 19:return e.abrupt("return",Object(T["c"])(r));case 20:case"end":return e.stop()}},e)})),K.apply(this,arguments)}function V(e,a,t,n){return F.apply(this,arguments)}function F(){return F=f()(h.a.mark(function e(a,t,n,c){var i,s,l,r,o,d,p,_,m,b,g,v;return h.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return l=t.images,r=t.videos,o=t.titles,d=t.bodies,p=t.call_to_action_types,_=t.link_urls,m=t.descriptions,b=r?r[M(r)].thumbnail_hash:l[M(l)].hash,e.next=10,S["getImages"](c,[b]);case 10:return g=e.sent,v=g.data,r?(a.format="video_data",a.video_id=r[M(r)].video_id,a.image_url=r[M(r)].thumbnail_url,n({type:"global/set_videos",payload:[u()({},v[0],{hash:a.video_id})]})):(a.format="photo_data",a.image_hash=b,n({type:"global/set_images",payload:v})),a=u()({},a,{name:o&&o[M(o)].text,message:d&&d[M(d)].text,link:_&&(null===(i=_[M(d)])||void 0===i?void 0:i.website_url),app_link:_&&(null===(s=_[M(d)])||void 0===s?void 0:s.deeplink_url),call_to_action:p&&p[M(p)],description:m&&m[M(m)].text}),e.abrupt("return",a);case 15:case"end":return e.stop()}},e)})),F.apply(this,arguments)}var G=e=>{var a=e.data,t=e.search,i=e.loading,s=e.updateTable,l=e.dispatch,r=e.campaigns_select,d=e.adset_select,u=e.selectKeys,m=e.adaccount_id,b=e.setCopyModel,v=e.global_images,y=e.copied_id,w=a.filter(e=>-1!==L["c"].indexOf(e.campaign.objective)),E=Object(n["useState"])(!1),O=o()(E,2),j=O[0],C=O[1],S=Object(n["useState"])(null),I=o()(S,2),N=I[0],T=I[1],M=Object(n["useRef"])(null),R=Object(n["useState"])(null),J=o()(R,2),K=J[0],V=J[1],F=Object(n["useState"])(null),G=o()(F,2),q=G[0],D=G[1],z=Object(n["useState"])(!1),Q=o()(z,2),H=Q[0],W=Q[1],Y=Object(n["useState"])(!1),X=o()(Y,2),U=X[0],Z=X[1];function B(e){return $.apply(this,arguments)}function $(){return $=f()(h.a.mark(function e(a){var t,n,c,i,s,r;return h.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.campaign,c=a.adset,i=g()(a,["campaign","adset"]),s=c.is_dynamic_creative,W(!0),e.next=5,P(i,n.objective,l,m,s);case 5:r=e.sent,Z(s),D(null===c||void 0===c?void 0:null===(t=c.promoted_object)||void 0===t?void 0:t.object_store_url),V(n),W(!1),T(a.id),M.current=r,C(!0);case 13:case"end":return e.stop()}},e)})),$.apply(this,arguments)}Object(n["useEffect"])(()=>{function e(e){return t.apply(this,arguments)}function t(){return t=f()(h.a.mark(function e(a){var t,n,c,i,s,r;return h.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=a.campaign,c=a.adset,i=g()(a,["campaign","adset"]),s=c.is_dynamic_creative,W(!0),e.next=5,P(i,n.objective,l,m,s);case 5:r=e.sent,Z(s),D(null===c||void 0===c?void 0:null===(t=c.promoted_object)||void 0===t?void 0:t.object_store_url),V(n),W(!1),T(a.id),M.current=r,C(!0);case 13:case"end":return e.stop()}},e)})),t.apply(this,arguments)}if(y){var n=a.find(e=>e.id===y);e(n),l({type:"global/set_copied_id",payload:""})}return()=>{}},[y,a,l,m]);var ee=[{title:"\u5e7f\u544a\u540d\u79f0",dataIndex:"name",render:(e,a)=>c.a.createElement("span",{className:k.a._a,onClick:e=>{B(a)}},e)},{title:"\u8425\u9500\u76ee\u6807",dataIndex:"objective",render:(e,a)=>c.a.createElement("span",null,a.campaign.objective)},{title:"\u6295\u653e\u72b6\u6001",dataIndex:"status",sorter:(e,a)=>e.status.toString().localeCompare(a.status),render:e=>e},{title:"\u64cd\u4f5c",key:"action",width:"15%",render:(e,a)=>c.a.createElement("span",null,c.a.createElement("span",{className:k.a._a,onClick:e=>{B(a)}},"\u7f16\u8f91"),c.a.createElement(_["a"],{type:"vertical"}),c.a.createElement("span",{className:k.a._a,onClick:e=>{l({type:"global/set_ads",payload:[a]}),b(!0)}},"\u590d\u5236"))}],ae={bordered:!0,rowSelection:{onChange(e,a){l({type:"global/set_ads",payload:a})},selectedRowKeys:u},pagination:{defaultPageSize:200,showQuickJumper:!0},scroll:a.length>20?{y:"calc(100vh - 343px)"}:void 0};function te(){var e=[];return r.length?(e=w.filter(e=>-1!==r.indexOf(e.campaign.id)),d.length?e.filter(e=>-1!==d.indexOf(e.adset_id)):e):d.length?w.filter(e=>-1!==d.indexOf(e.adset_id)):w}return c.a.createElement(c.a.Fragment,null,c.a.createElement(p["a"],{spinning:H,tip:"\u6b63\u5728\u52a0\u8f7d\u7f16\u8f91\u4fe1\u606f...",delay:500},c.a.createElement(x["a"],{params:ae,dataSource:te(),columns:ee,loading:i,search:t})),M.current?c.a.createElement(A,{adaccount_id:m,objective:K.objective,title:"\u7f16\u8f91\u5e7f\u544a",visible:j,setVisible:C,updateTable:s,ads_id:N,initailState:M.current,object_store_url:q,is_dynamic_creative:U,reset:e=>e({type:"reset",payload:M.current}),images:v}):"")},q=(e,a)=>{return{adaccount_id:e.global.adaccount_id,selectKeys:e.global.ads.map(e=>e.key),adset_select:e.global.adsets.map(e=>e.id),campaigns_select:e.global.campaigns.map(e=>e.id),global_images:e.global.images,copied_id:e.global.copied_id}},D=Object(s["c"])(q)(G),z=t("m5kd"),Q=(t("OaEy"),t("2fM7")),H=t("glEz"),W=t("hqdU"),Y=t("7IlV"),X=t.n(Y),U=Q["a"].Option,Z=[{name:"\u539f\u6709\u5e7f\u544a\u7cfb\u5217",key:"ORIGINAL"},{name:"\u5176\u4ed6\u5e7f\u544a\u7cfb\u5217",key:"OTHER"}],B=e=>{var a=e.ads,t=e.dispatch,i=e.title,s=e.visible,l=e.setVisible,r=e.updateTable,d=e.adaccount_id,u=e.campaigns_cache,p=Object(n["useState"])(1),m=o()(p,2),b=m[0],g=m[1],v=Object(n["useState"])("ORIGINAL"),y=o()(v,2),k=y[0],x=y[1],w=Object(n["useState"])([]),O=o()(w,2),j=O[0],C=O[1],I=Object(n["useState"])(null),N=o()(I,2),A=N[0],T=N[1],L=Object(n["useState"])([]),M=o()(L,2),P=M[0],R=M[1],J=Object(n["useState"])([]),K=o()(J,2),V=K[0],F=K[1];function G(e){return q.apply(this,arguments)}function q(){return q=f()(h.a.mark(function e(n){var c,i,s,o;return h.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(c=[],b>1)for(i=0;i<b;i++)c=[...c,...a.slice()];else c=[...c,...a.slice()];if(!(V.length>0)){e.next=8;break}return e.next=5,S["copyAds"](c,V);case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,S["copyAds"](c);case 10:e.t0=e.sent;case 11:if(s=e.t0,!s){e.next=21;break}return console.log(s),n(!1),l(!1),t({type:"global/set_ads",payload:[]}),e.next=19,r();case 19:o=JSON.parse(s[0].result).copied_ad_id,t({type:"global/set_copied_id",payload:o});case 21:case"end":return e.stop()}},e)})),q.apply(this,arguments)}function D(e){T(e)}return Object(n["useEffect"])(()=>{var e=!1;function a(){return n.apply(this,arguments)}function n(){return n=f()(h.a.mark(function a(){var n,c;return h.a.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,S["getCampaign"](d);case 2:n=a.sent,c=n.data,e||(C(c),t({type:"global/set_campaigns_cache",payload:{data:c,isFetch:!1}}));case 5:case"end":return a.stop()}},a)})),n.apply(this,arguments)}return d&&u.isFetch?a():C(u.data),()=>{e=!0}},[d,u,t]),Object(n["useEffect"])(()=>{var e=!1;function a(){return t.apply(this,arguments)}function t(){return t=f()(h.a.mark(function a(){var t;return h.a.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,S["getCampaignAdset"](A);case 2:t=a.sent,e||R(t);case 4:case"end":return a.stop()}},a)})),t.apply(this,arguments)}return A&&a(),()=>{e=!0}},[A]),c.a.createElement(E["a"],{width:700,title:i,visible:s,handle:e=>{G(e)},handleCancel:()=>{l(!1)}},c.a.createElement("div",null,c.a.createElement(W["a"],{options:Z,pattern:k,onChange:e=>{x(e.target.value)}}),"OTHER"===k&&c.a.createElement("div",null,c.a.createElement("div",{className:X.a.select_container},c.a.createElement(Q["a"],{showSearch:!0,style:{width:"100%"},placeholder:"\u9009\u62e9\u5e7f\u544a\u7cfb\u5217",optionFilterProp:"children",onChange:D,filterOption:(e,a)=>a.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},j.map((e,a)=>c.a.createElement(U,{key:e.id,value:e.id},e.name)))),c.a.createElement(_["a"],null),c.a.createElement("div",null,c.a.createElement("p",null,"\u52a0\u5165\u5e7f\u544a\u7ec4"),c.a.createElement("div",{className:X.a.select_container},c.a.createElement(Q["a"],{showSearch:!0,mode:"multiple",style:{width:"100%"},placeholder:A?"\u9009\u62e9\u5e7f\u544a":"\u8bf7\u5148\u9009\u62e9\u5e7f\u544a\u7cfb\u5217",optionFilterProp:"children",onChange:e=>F(e),filterOption:(e,a)=>a.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},P.map((e,a)=>c.a.createElement(U,{key:e.id,value:e.id},e.name)))))),c.a.createElement(_["a"],null),c.a.createElement(H["a"],{setNum:g,label:"\u6bcf\u4e2a\u5e7f\u544a\u7684\u526f\u672c\u6570\u91cf"})))},$=(e,a)=>{return{ads:e.global.ads,campaigns_cache:e.global.campaigns_cache,adaccount_id:e.global.adaccount_id}},ee=Object(s["c"])($)(B),ae=c.a.memo(e=>{var a=e.adaccount_id,t=e.campaigns_select_length,i=e.adset_select_length,s=e.dispatch,r=e.data,d=e.setSearch,u=e.defaultCurrent,p=e.total,_=e.paging,m=e.nextOrPrevious,h=e.setDefaultCurrent,b=e.loading,g=e.search,v=e.updateTable,f=e.ads,y=Object(n["useState"])(!1),x=o()(y,2),w=x[0],E=x[1];return c.a.createElement("div",{className:k.a.adset},c.a.createElement(z["a"],{adaccount_id:a,setSearch:d,defaultCurrent:u,total:p,paging:_,loading:b,num:50,nextOrPrevious:m,setDefaultCurrent:h,setCopyModel:E,copy_bool:f.length>0,createDirection:"ads"},t>0&&c.a.createElement("span",{className:k.a.select_close,onClick:()=>s({type:"global/set_campaigns",payload:[]})},"\u5df2\u9009\u4e2d",t,"\u9879\u5e7f\u544a\u7cfb\u5217"," ",c.a.createElement(l["a"],{type:"close-circle"})),i>0&&c.a.createElement("span",{className:k.a.select_close,onClick:()=>s({type:"global/set_adsets",payload:[]})},"\u5df2\u9009\u4e2d",i,"\u9879\u5e7f\u544a\u7ec4 ",c.a.createElement(l["a"],{type:"close-circle"}))),c.a.createElement(D,{data:r,loading:b,search:g,setCopyModel:E,updateTable:v}),c.a.createElement(ee,{title:"\u628a\u5e7f\u544a\u590d\u5236\u5230",visible:w,setVisible:E,updateTable:v}))}),te=(e,a)=>{return{adset_select_length:e.global.adsets.map(e=>e.id).length,campaigns_select_length:e.global.campaigns.map(e=>e.id).length,ads:e.global.ads}},ne=Object(s["c"])(te)(ae),ce=e=>{var a=e.adaccount_id;return c.a.createElement(i["a"],{WrappedComponent:ne,method:"getAds",adaccount_id:a})},ie=(e,a)=>{return{adaccount_id:e.global.adaccount_id}};a["default"]=Object(s["c"])(ie)(ce)}}]);